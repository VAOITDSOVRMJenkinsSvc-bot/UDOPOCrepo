typeof UDO=="undefined"&&(UDO={__namespace:!0});var globalContext=Xrm.Utility.getGlobalContext(),version=globalContext.getVersion(),lib,webApi,formHelper;UDO.CustomActions=function(){function o(n){lib=new CrmCommonJS.CrmCommon(version,n);webApi=lib.WebApi;formHelper=new CrmCommonJS.FormHelper(n)}function s(n,t,i,r,u,e,o){var s=n.getEventSource();s.getVisible()&&s.getDisplayState()==="expanded"&&f(n,t,i,r,u,e,o)}function h(n,t,i,r,u,e){o(n);f(n,t,i,r,u,e)}function f(f,e,o,s,h,l,a){var p,v,k,d,y,w,b;if(formHelper.getAttribute("udo_itfloading")!==null&&(formHelper.setValue("udo_itfloading",752280002),formHelper.setSubmitMode("udo_itfloading",!0),formHelper.saveRecord()),r.indexOf(s)===-1)r.push(s);else return;if(p=formHelper.getEntityLogicalName(),p!==e){if(!formHelper.getValue("udo_idproofid"))return;v=formHelper.getSelectedLookupId("udo_idproofid")}else v=formHelper.getCurrentRecordIdFormatted();if(k=o,d=null,o===""){u(f,v,e,s,h,l,a,!1);return}if(p===e&&(y=formHelper.getAttribute(o),y!==null))if(w=y.getAttributeType(),b=y.getValue(),w==="optionset"){if(b===752280002){i(f,s);t&&n&&(n=!1,formHelper.refreshRecord());return}}else if(w==="boolean"){if(b){i(f,s);t&&n&&(n=!1,formHelper.refreshRecord());return}}else{i(f,s);formHelper.setFormNotification("Invalid complete flag supplied for "+s+". If the issue persist please contact your System Administrator.","WARNING",s);t&&n&&(n=!1,formHelper.refreshRecord());return}webApi.RetrieveRecord(v,e,null).done(function(n){c(f,n,v,e,o,s)})}function c(r,f,e,o,s,h,c,l,a){var v=!1;v=f[s];!v||v&&v!==!0&&v!==752280002?u(r,e,o,h,c,l,a):(i(r,h),t&&n&&(n=!1,formHelper.refreshRecord()))}function l(n,t,i,r){var s={},o={},u,f,e;if(o[t+"id"]=n,o["@odata.type"]="Microsoft.Dynamics.CRM."+t,s.ParentEntityReference=o,parameterTypes={ParentEntityReference:{typeName:"mscrm.crmbaseentity",structuralProperty:5}},r)for(u=0;u<r.length;u++)parameterTypes[r[u].Key]={typeName:r[u].Type,structuralProperty:1};if(f={ParentEntityReference:s.ParentEntityReference,getMetadata:function(){return{boundParameter:null,parameterTypes:parameterTypes,operationType:0,operationName:i}}},r){for(e=0;e<r.length;e++)f[r[e].Key]=r[e].Value;console.log(f.getMetadata.parameterTypes);console.log(r);console.log(f)}return f}function u(n,t,r,u,f,e){formHelper.setFormNotification("Retrieving data from source systems for "+u+". Please wait.","INFO",u);var o=l(t,r,u,e);webApi.executeAction(o).done(function(){i(n,u)})}function i(n,i){formHelper.clearFormNotification(i);var u=r.indexOf(i);return u!==-1&&r.splice(u,1),r.length>0?!1:(t=!0,!0)}var r=[],t,n=!1,e=0;return{OnLoad:h,OnTabOpen:s,OnActionParams:f}}();UDO.CustomActions.USD=function(){function a(n,t){if(n.Timeout==!0&&r=="true"&&retryCount<50){retryCount++;setTimeout(executeAction(parentEntityId,parentEntityName,t,refreshGrid,i,r),5e3);return}$("#loadingGifDiv").hide();s(t);n.DataIssue!=!1||n.Timeout!=!1||n.Exception!=!1?($("#notFoundDiv").text(n.ResponseMessage),$("#notFoundDiv").show()):window.open(u,"_self")}function s(n){var i=t.indexOf(n);return i!=-1&&t.splice(i,1),t.length>0?!1:(c=!0,!0)}function v(){var n=[],i,t;if(location.search!=""){n=location.search.substr(1).split("&");for(t in n)n[t]=n[t].replace(/\+/g," ").split("=");i=!1;for(t in n)if(n[t][0].toLowerCase()=="data"){y(n[t][1]);i=!0;break}if(!i){$("#loadingGifDiv").hide();$("#notFoundDiv").text("No Parameters passed to dialog");$("#notFoundDiv").show();return}}else{$("#loadingGifDiv").hide();$("#notFoundDiv").text("No Parameters passed to dialog");$("#notFoundDiv").show();return}}function y(t){var u,s;if(t!=""){u=[];u=decodeURIComponent(t).split("&");for(s in u){u[s]=u[s].replace(/\+/g," ").split("=");switch(u[s][0].toLowerCase()){case"entityid":e=u[s][1];break;case"entityname":o=u[s][1];break;case"requestname":n=u[s][1];break;case"nexteventname":f=u[s][1];break;case"additionalparams":i=u[s][1];break;case"handletimetout":r=u[s][1]}}}else{$("#loadingGifDiv").hide();$("#notFoundDiv").text("No Parameters passed to dialog");$("#notFoundDiv").show();return}}var h=!1,u="",f,e=null,o=null,n=null,i,t=[],c,r=null,l=function(){if(v(),t.indexOf(n)==-1)t.push(n);else return;$("#notFoundDiv").hide();$("#loadingGifDiv").focus();u="http://event/?eventName="+f;var r=[{Key:"ParentEntityReference",Type:Va.Udo.Crm.Scripts.Process.DataType.EntityReference,Value:{id:e,entityType:o}}];i&&(r=$.merge(i,r));Va.Udo.Crm.Scripts.Process.ExecuteAction(n,r).done(function(t){a(t,n)}).fail(function(t){s(n);$("#loadingGifDiv").hide();h==!1?$("#notFoundDiv").text("An error occurred while attempting to process this request. Please refresh the page and try again. If this error persists, please contact the application support team."):$("#notFoundDiv").text(t.responseText);$("#notFoundDiv").show()})};return{onLoad:l}}();