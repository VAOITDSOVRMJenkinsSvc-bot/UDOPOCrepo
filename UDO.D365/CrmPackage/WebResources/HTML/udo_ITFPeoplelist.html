<html>
<head>
    <meta charset="utf-8">
    <title>People List</title>

    <style type="text/css">
        fieldset {
            color: rgb(0,0,0);
            direction: ltr;
            font-family: "Segoe UI","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            font-size: 16px;
            font-weight: 100;
            margin-bottom: 14px;
            margin-left: 0;
            margin-right: 0;
            margin-top: 0;
            background-color: rgb(255,255,255);
            padding: 2px;
            border: solid 0 #ffffff;
            width: 100%;
        }

        button {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        table {
            border-collapse: collapse;
            font-family: "Segoe UI","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            width: 705px;
        }

        th {
            background-color: rgb(0,32,80);
            color: white;
            font-family: "Segoe UI Light","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            font-size: 16px;
            font-weight: 600;
            white-space: nowrap;
            text-align: left;
        }

        td {
            padding: 5px;
            white-space: nowrap;
        }

        .odd {
            background-color: white;
            cursor: pointer;
        }

        .even {
            background-color: whitesmoke;
            cursor: pointer;
        }

        .disabled {
            font-style: italic;
            color: #9c0000;
        }

        .hover {
            background-color: #99ccff !important;
            color: #800000 !important;
        }

        div#tmpDialog {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            width: 250px;
            height: 50px;
            margin: -101px 0 0 -251px;
            background: rgb(255, 255, 255);
            border: 1px solid black;
        }

            div#tmpDialog img {
                float: left;
                height: 45px;
                width: 45px;
                padding: 5px 10px 5px 5px;
                text-align: left;
            }

            div#tmpDialog p {
                padding: 5px;
                margin: 15px 5px 5px 5px;
                text-align: left;
            }

        input {
            background-color: rgba(255,255,255,0);
            border-color: rgb(186,186,186);
            border-width: 1px;
            border-style: solid;
            color: rgb(0,0,0);
            font-family: "Segoe UI","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            font-size: 14.06px;
            height: 30px;
        }

        div {
            color: rgb(0,0,0);
            direction: ltr;
            /*float: left;*/
            font-family: "Segoe UI","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            font-size: 12.06px;
            padding-bottom: 4px;
            padding-top: 0;
            text-align: left;
        }

        button {
            background-color: rgb(0,32,80);
            border-color: rgb(255,255,255);
            border-style: none;
            border-width: 0px;
            color: rgb(255,255,255);
            direction: ltr;
            font-family: "Segoe UI Semibold","Segoe UI Web Semibold","Segoe UI Web Regular","Segoe UI","Segoe UI Symbol","HelveticaNeue-Medium","Helvetica Neue",Arial,sans-serif;
            font-size: 14.06px;
            height: 30px;
            min-width: 84.4px;
            padding-bottom: 10px;
            padding-left: 12px;
            padding-right: 12px;
            padding-top: 5px;
            margin-right: 6px;
        }

        h1 {
            font-family: 'Segoe UI',Tahoma,Arial;
            font-weight: 100;
            color: #262626;
            font-size: 36px;
            margin-bottom: 12px;
        }

        h3 {
            font-family: 'Segoe UI',Tahoma,Arial;
            font-weight: 100;
            color: #262626;
            font-size: 22px;
            margin-bottom: 12px;
            margin-top: 8px;
        }

        h2 {
            color: rgb(0,0,0);
            direction: ltr;
            font-family: "Segoe UI","Segoe UI Web Regular","Segoe UI Symbol","Helvetica Neue","BBAlpha Sans","S60 Sans",Arial,sans-serif;
            font-size: 14.06px;
            font-weight: 100;
            margin-bottom: 14px;
            margin-left: 0px;
            margin-right: 0px;
            margin-top: 0px;
        }

        fieldset {
            border: 0;
        }
    </style>
    <script src="udo_Xrm.min.js" type="text/javascript"></script>
    <script src="udo_jquery_1.9.1.min.js" type="text/javascript"></script>
    <script src="udo_utility.js" type="text/javascript"></script>
    <script src="udo_CRMCommonJS.js" type="text/javascript"></script>
    <script src="crme_SDK.REST.js" type="text/javascript"></script>
    <script src="crme_json2.js" type="text/javascript"></script>

    <script type="text/javascript">
        var Va = Va || {};
        Va.Udo = Va.Udo || {};
        Va.Udo.Crm = Va.Udo.Crm || {};
        Va.Udo.Crm.Scripts = Va.Udo.Crm.Scripts || {};
        Va.Udo.Crm.Scripts.PeopleList = Va.Udo.Crm.Scripts.PeopleList || {};

        Va.Udo.Crm.Scripts.PeopleList.Config = {
            "CADD": {
                ConfigName: "CADD",
                EntityName: "va_bankaccount",
                Name: "CADD",
                Title: "CADD - PEOPLE LIST",
                Header: "CADD - Select Person",
                RequireSelection: true,
                Filter: "udo_IDProofId/Id eq (guid'/idproofid/') and udo_ptcpntid ne null",
                SelectionTypes: [411] //All
            },
            "LETTERS": {
                ConfigName: "LETTERS",
                EntityName: "udo_letter",
                Name: "Letter",
                Title: "LETTERS - PEOPLE LIST",
                Header: "Letters - Select Person",
                RequireSelection: true,
                Filter: "udo_IDProofId/Id eq (guid'/idproofid/') and udo_ptcpntid ne null",
                SelectionTypes: [411] //All
            },
            "SERVICEREQUEST": {
                ConfigName: "SERVICEREQUEST",
                EntityName: "udo_servicerequest",
                Name: "Service Request",
                Title: "SERVICE REQUEST - PEOPLE LIST",
                Header: "Letters - Select Person",
                RequireSelection: false,  // Allow the creation of a service request without a person selected
                CreateWithoutPersonLabel: "Create Service Request without Payee details",
                CreateWithoutPersonLegend: "If you can't find the person/payee in the list below, you can create a service request without Payee details.",
                Filter: "udo_IDProofId/Id eq (guid'/idproofid/')",
                SelectionTypes: [411] //All
            },
            "ITF": {
                ConfigName: "ITF",
                EntityName: "va_intenttofile",
                Name: "Intent To File",
                Title: "ITF - PEOPLE LIST",
                Header: "ITF - Select Person",
                RequireSelection: true,
                Filter: "udo_IDProofId/Id eq (guid'/idproofid/') and udo_Type/Value ne 752280003 and udo_ptcpntid ne null",
                SelectionTypes: [411] //All
            },
            "FNOD": {
                ConfigName: "FNOD",
                EntityName: "va_fnod",
                Name: "First Notice of Death (FNOD)",
                Title: "FNOD - PEOPLE LIST",
                Header: "FNOD - Select Person",
                RequireSelection: true,
                Filter: "udo_IDProofId/Id eq (guid'/idproofid/') and udo_Type/Value ne 752280003",
                SelectionTypes: [752280000]
            }
        }
        var context = GetGlobalContext();
        var version = context.getVersion();
        var lib = new CrmCommonJS(version);
        var webApi = lib.WebApi;

        Va.Udo.Crm.Scripts.PeopleList.Select = function (data) {
            var Config = {};
            Config = Va.Udo.Crm.Scripts.PeopleList.Config[Va.Udo.Crm.Scripts.PeopleList.SearchType];

            function create_callback(data) {
                $('div#tmpDialog').hide(100);
                //var cadd_formid = "&extraqs=formid%3D55B7B6EE-E430-4C7B-944B-8DA67B65284C%0D";

                if (data != null && data.length > 0) {
                    if (Va.Udo.Crm.Scripts.PeopleList.SearchType == "ITF") {

                        getUrl = function (etn, parameters) {
                            var url = "";
                            for (var key in parameters) {
                                if (parameters.hasOwnProperty(key)) {
                                    url = url + key + "=" + parameters[key] + "&";
                                }
                            }

                            url = encodeURIComponent(url);
                            url = "../main.aspx?etn=" + etn + "&pagetype=entityrecord&extraqs=" + url;
                            return url;
                        };

                        var itfParams = data[0].crme_itfparameters;
                        if (itfParams != null && itfParams.length > 0) {
                            //prompt("itfParams", itfParams);
                            var parameters = setITFParameters(itfParams);
                            //Xrm.Utility.openEntityForm("va_intenttofile", null, parameters);
                            var url = getUrl("va_intenttofile", parameters);
                            window.open(url);
                        }
                        else {
                            var returnMessage = data[0].crme_ReturnMessage;
                            alert(returnMessage);
                        }
                        return;
                    }

                    var url = data[0].crme_url;
                    if (url != null && url.length > 0) {
                        //prompt("url", url + cadd_formid);
                        //console.log("URL - " + url);
                        window.open(url);
                    }
                    else {
                        var targetEntity = data[0].crme_SearchType;
                        if (targetEntity == Config.ConfigName) targetEntity = Config.EntityName;
                        if (targetEntity != null) {
                            //TODO: convert to WebAPI
                            var url = context.getClientUrl() + "/main.aspx?etn=" + targetEntity + "&pagetype=entityrecord&id=" + data[0].crme_personId;
                            window.open(url);
                            //document.location.href = url;
                            // Using Xrm.Utility.openEntityForm causes an error to popup in USD.
                            //Xrm.Utility.openEntityForm(targetEntity,data[0].crme_personId,{},{openInNewWindow:false});
                        } else {
                            var returnMessage = data[0].crme_ReturnMessage;
                            alert("Return Message - " + returnMessage);
                        }
                    }
                }
                else {
                    alert("No Data Returned.");
                }
            }

            function create(obj) {
                var buildQueryFilter = function (field, value, filter) {
                    if (filter.length > 0) {
                        return " and " + field + " eq '" + value + "'";
                    } else {
                        return field + " eq '" + value + "'";
                    }
                };

                $('div#tmpDialog').show();

                var filter = "";
                if (obj != null) {
                    var personId = obj.getAttribute('personid');
                    if (personId == '') {
                        alert('Veteran or Dependent has not been initiated');
                        return false;
                    }
                    filter += buildQueryFilter("crme_udopersonguid", personId, filter);
                }

                // Not all search types use these, but some do, so it is easier to include them
                filter += buildQueryFilter("crme_udoidproofid", Config.Data.IDProofId, filter);
                filter += buildQueryFilter("crme_udoveteranid", Config.Data.VeteranId, filter);
                filter += buildQueryFilter("crme_udointeractionid", Config.Data.InteractionId, filter);
                filter += buildQueryFilter("crme_SearchType", Va.Udo.Crm.Scripts.PeopleList.SearchType, filter);


                filter = "$select=*&$filter=" + filter;
                SDK.REST.retrieveMultipleRecords("crme_person", filter, create_callback, function (error) { alert("Error Opening Record: " + error.message); }, create_complete);
            }

            function setITFParameters(xmlData) {
                //alert('In set ITF params');
                var parameters = {};

                parameters["udo_idproofid"] = idProofId;
                //parameters["udo_idproofidname"] = '[[Id Proof.udo_title]+]';
                //parameters["udo_idproofidtype"] = '[[Id Proof.LogicalName]+]';

                parameters["udo_veteranid"] = veteranId;
                //parameters["udo_veteranidname"] = '[[Veteran.fullname]+]';
                //parameters["udo_veteranidtype"] = '[[Veteran.LogicalName]+]';

                var relStr = relationshipStr;
                if (relStr != "") {
                    var relArr = relStr.split(',');
                    relationship = relArr[1];
                }


                //alert(parameters["udo_veteranid"]);

                var xmlDoc = $.parseXML(xmlData);
                var $xml = $(xmlDoc);
                //parameters["va_phonecallid"] = $xml.find('va_phonecallid').text();
                //parameters["va_phonecallidname"] = $xml.find('va_phonecallidname').text();
                parameters["va_participantid"] = $xml.find('va_participantid').text();


                //if (($xml.find('va_claimantparticipantid').text() != "") && (relationship == "Veteran(Self)" || relationship == "VSO/POA/AA" || relationship == "Fiduciary" || relationship || "Other")) {
                //    parameters["va_claimantparticipantid"] = $xml.find('va_participantid').text();
                //}
                //else {
                parameters["va_claimantparticipantid"] = $xml.find('va_claimantparticipantid').text();
                //}
                if ($xml.find('va_veteranfirstname').text() != "") { parameters["va_veteranfirstname"] = $xml.find('va_veteranfirstname').text(); }

                //if (($xml.find('va_veteranfirstname').text() != "") && (relationship == "Veteran(Self)")) { parameters["va_claimantfirstname"] = $xml.find('va_veteranfirstname').text(); }
                //else {
                parameters["va_claimantfirstname"] = $xml.find('va_claimantfirstname').text();
                //}
                if ($xml.find('va_veteranlastname').text() != "") { parameters["va_veteranlastname"] = $xml.find('va_veteranlastname').text(); }
                //if (($xml.find('va_veteranlastname').text() != "") && (relationship == "Veteran(Self)")) { parameters["va_claimantlastname"] = $xml.find('va_veteranlastname').text(); }
                //else {
                parameters["va_claimantlastname"] = $xml.find('va_claimantlastname').text();
                //}
                if ($xml.find('va_veteranmiddleinitial').text() != "") { parameters["va_veteranmiddleinitial"] = $xml.find('va_veteranmiddleinitial').text(); }
                //if (($xml.find('va_veteranmiddleinitial').text() != "") && (relationship == "Veteran(Self)")) { parameters["va_claimantmiddleinitial"] = $xml.find('va_veteranmiddleinitial').text(); }
                //else {
                parameters["va_claimantmiddleinitial"] = $xml.find('va_claimantmiddleinitial').text();
                //}
                if ($xml.find('va_veteranssn').text() != "") { parameters["va_veteranssn"] = $xml.find('va_veteranssn').text(); }
                //if (($xml.find('va_veteranssn').text() != "") && (relationship == "Veteran(Self)")) { parameters["va_claimantssn"] = $xml.find('va_veteranssn').text(); }
                //else {
                parameters["va_claimantssn"] = $xml.find('va_claimantssn').text();
                //}
                if ($xml.find('va_filenumber').text() != "") { parameters["va_veteranfilenumber"] = $xml.find('va_filenumber').text(); }
                if ($xml.find('va_veteranphone').text() != "") { parameters["va_veteranphone"] = $xml.find('va_veteranphone').text(); }
                if ($xml.find('va_veterandateofbirth').text() != "") { parameters["va_veterandateofbirth"] = $xml.find('va_veterandateofbirth').text(); }
                if ($xml.find('va_veteranaddressline1').text() != "") { parameters["va_veteranaddressline1"] = $xml.find('va_veteranaddressline1').text(); }
                if ($xml.find('va_veteranaddressline2').text() != "") { parameters["va_veteranaddressline2"] = $xml.find('va_veteranaddressline2').text(); }
                if ($xml.find('va_veteranunitnumber').text() != "") { parameters["va_veteranunitnumber"] = $xml.find('va_veteranunitnumber').text(); }
                if ($xml.find('va_veterancity').text() != "") { parameters["va_veterancity"] = $xml.find('va_veterancity').text(); }
                if ($xml.find('va_veteranstate').text() != "") { parameters["va_veteranstate"] = $xml.find('va_veteranstate').text(); }
                if ($xml.find('va_veteranzip').text() != "") { parameters["va_veteranzip"] = $xml.find('va_veteranzip').text(); }
                if ($xml.find('va_veterancountry').text() != "") { parameters["va_veterancountry"] = $xml.find('va_veterancountry').text(); }
                if ($xml.find('va_veteranemail').text() != "") { parameters["va_veteranemail"] = $xml.find('va_veteranemail').text(); }
                if ($xml.find('va_militarypostalcodevalue').text() != "") { parameters["va_militarypostalcodevalue"] = $xml.find('va_militarypostalcodevalue').text(); }
                if ($xml.find('va_militarypostofficetypecodevalue').text() != "") { parameters["va_militarypostofficetypecodevalue"] = $xml.find('va_militarypostofficetypecodevalue').text(); }
                if ($xml.find('va_gender').text() != "") {
                    if ($xml.find('va_gender').text() == "Male") { parameters["va_veterangender"] = "0"; }
                    else parameters["va_veterangender"] = "1";

                    // parameters["va_veterangender"] = $xml.find('va_gender').text(); }
                }
                return parameters;
            }


            function create_complete() {
                $('div#tmpDialog').hide();
            }
            create(data);
        };

        Va.Udo.Crm.Scripts.PeopleList.InitializeStatus = "";
        Va.Udo.Crm.Scripts.PeopleList.Initialize = function () {
            var Config = {};

            function execute() {
                Va.Udo.Crm.Scripts.PeopleList.InitializeStatus = "Initializing";
                $('div#tmpDialog').show();
                $("#resultsFieldSetDiv").hide();
                $("#notFoundDiv").hide();
                Va.Udo.Crm.Scripts.PeopleList.SearchType = SearchType = getParamValue("type");
                Config = Va.Udo.Crm.Scripts.PeopleList.Config[Va.Udo.Crm.Scripts.PeopleList.SearchType];
                Config.Data = {
                    VeteranId: getParamValue("vetid"),
                    IDProofId: getParamValue("idproofid"),
                    InteractionId: getParamValue("intrid")
                };
                if (!Config.RequireSelection) {
                    var buttontext = Config.CreateWithoutPersonLabel;
                    var legendtext = Config.CreateWithoutPersonLegend;
                    var btn = $("#createWithoutPersonButton");
                    btn.attr('title', buttontext);
                    btn.text(buttontext);
                    btn.bind("click", function () {
                        Va.Udo.Crm.Scripts.PeopleList.Select(null);
                    });

                    $("#createWithoutPersonFieldset").prepend("<legend>" + legendtext + "</legend>");
                    $("#createWithoutPerson").css('display', 'block');
                } else {
                    $("#createWithoutPerson").remove();
                }
                $("#ListTitle").text(Config.Title);
                $(document).attr("title", Config.Title);
                getPeople();
            }

            function getParamValue(name) {
                var par = Va.Udo.Crm.Scripts.Utility.getUrlParams();
                return par.data[name];
            }

            function getPeople() {
                var filter = Config.Filter;
                filter = filter.replace("/idproofid/", Config.Data.IDProofId);
                filter = filter.replace("/vetid/", Config.Data.VeteranId);
                var options = "$select=udo_personId,udo_name,udo_dobstr,udo_Type,udo_SSN,udo_ptcpntid," +
                              "udo_payeeCode,udo_awardtypecode,udo_fidexists," +
                              "udo_awardsexist,udo_pendingclaimsexist&$filter=" + filter;

                var columns = ["udo_personid", "udo_name", "udo_dobstr", "udo_Type", "udo_SSN", "udo_ptcpntid",
                              "udo_payeeCode","udo_awardtypecode","udo_fidexists",
                              "udo_awardsexist,udo_pendingclaimsexist"]
                var queryFilter = "$filter=" + filter;
                //TODO: convert to WebAPI
                //SDK.REST.retrieveMultipleRecords("udo_person", options, getPeople_callback, function (error) { alert("Error Retrieving People:" + error.message); }, getPeople_complete)                
                webApi.RetrieveMultiple("udo_person", columns, queryFilter)
                .then(function(data){
                        getPeople_callback(data);
                        getPeople_complete()
                    }
                )
                .catch(function(error){
                    alert("Error Retrieving People:" + error.message);
                })
            }

            function getPeople_callback(data, textStatus, XmlHttpRequest) {
                $('div#tmpDialog').show();

                // get the table
                var table = $("#personSearchResultsTable");

                // reset the table by removing all data rows
                $("#personSearchResultsTable").find("thead, tr, th").remove();
                $("#personSearchResultsTable").find("tr:gt(0)").remove();
                $("#resultsFieldSetDiv").hide();

                if (data != null && data.length > 0) {

                    var thead = document.createElement('thead');
                    var theadRow = document.createElement('tr');

                    for (var i = 0; i < data.length; i++) {

                        var personid = data[i].udo_personId == null ? "" : data[i].udo_personId;
                        var name = data[i].udo_name == null ? "" : data[i].udo_name;
                        //var DOB = data[i].udo_DOB == null ? "" : data[i].udo_DOB.toLocaleDateString();
                        var DOB = data[i].udo_dobstr == null ? "" : data[i].udo_dobstr;
                        var personType = data[i].udo_Type == null ? "0" : data[i].udo_Type.Value;
                        var personTypeName = "";
                        switch (personType) {
                            case 752280000:
                                personTypeName = "Veteran";
                                break;
                            case 752280001:
                                personTypeName = "Dependent";
                                break;
                            case 752280002:
                                personTypeName = "Beneficiary";
                                break;
                            case 752280003:
                                personTypeName = "Associated Contact";
                                break;
                        }
                        var SSN = data[i].udo_SSN == null ? "" : data[i].udo_SSN;
                        var participantId = data[i].udo_ptcpntid == null ? "" : data[i].udo_ptcpntid;
                        var payeecode = data[i].udo_payeeCode == null ? "" : data[i].udo_payeeCode;
                        //var Type = data[i].udo_type == null ? "" : data[i].udo_type;
                        var Type = data[i].udo_awardtypecode == null ? "" : data[i].udo_awardtypecode;
                        var fidExists = data[i].udo_fidexists == null ? false : data[i].udo_fidexists;
                        var awardExist = data[i].udo_awardsexist == null ? false : data[i].udo_awardsexist;
                        var pendingClaimsExists = data[i].udo_pendingclaimsexist == null ? false : data[i].udo_pendingclaimsexist;

                        if (i == 0) {
                            var newTH = function (title, id) {
                                var th = document.createElement('th');
                                th.appendChild(document.createTextNode(title));
                                th.id = id;
                                th.title = title;
                                th.scope = 'col';
                                return th;
                            }

                            theadRow.appendChild(newTH('Name', 'name'));
                            theadRow.appendChild(newTH('Type', 'personType'));
                            theadRow.appendChild(newTH('DOB', 'dob'));
                            theadRow.appendChild(newTH('SSN', 'ssn'));
                            theadRow.appendChild(newTH('Participant Id', 'participantId'));
                            theadRow.appendChild(newTH('Payee Code', 'payeeCode'));
                            theadRow.appendChild(newTH('Award Type', 'awardType'));

                            thead.appendChild(theadRow);
                        }

                        // Table rows
                        var row = document.createElement('tr');

                        var newCell = function (content) {
                            var cell = document.createElement('td');
                            cell.appendChild(document.createTextNode(content));
                            return cell;
                        }

                        var col1 = newCell(name);
                        col1.scope = 'row';

                        row.appendChild(col1);

                        row.appendChild(newCell(personTypeName));
                        row.appendChild(newCell(DOB));
                        row.appendChild(newCell(SSN));
                        row.appendChild(newCell(participantId));
                        row.appendChild(newCell(payeecode));
                        row.appendChild(newCell(Type));

                        row.setAttribute('personid', personid);
                        row.setAttribute('fidExists', fidExists);
                        row.setAttribute('awardExist', awardExist);
                        row.setAttribute('pendingClaimsExist', pendingClaimsExists);

                        row.tabIndex = 100 + i;
                        row.className = (i % 2 == 0) ? "even" : "odd";

                        row.ondblclick = function () { Va.Udo.Crm.Scripts.PeopleList.Select(this); };

                        row.onkeypress = function (e) {
                            if (e.keyCode === 13 || e.keyCode === 32) {
                                Va.Udo.Crm.Scripts.PeopleList.Select(this);
                            }
                        }

                        var disabled = false;
                        if (($.inArray(411, Config.SelectionTypes) == -1) && ($.inArray(personType, Config.SelectionTypes) == -1)) {
                            // not selectable
                            disabled = true;
                            row.className += " disabled";
                            $(row).find("td:first").append("<span class='na'> (not selectable)</span>");
                            row.ondblclick = null;
                            row.onkeypress = null;
                        }

                        row.title = "Name - " + name + ", Type - " + personTypeName + ", DOB - " + DOB +
                                    ", SSN - " + SSN + ", Participant Id - " + participantId +
                                    ", Payee Code - " + payeecode + ", Award Type - " + Type;

                        if (!disabled) {
                            row = $(row);

                            row.hover(function () {
                                $(this).addClass("hover");
                            }, function () {
                                $(this).removeClass("hover");
                            });
                        }

                        table.append(thead);
                        table.append(row);

                        $("#resultsFieldSetDiv").show();
                        if (i == 1)
                            row.focus = true;
                    }
                }
                else {
                    $("#notFoundDiv").show();
                }
                $("#searchResultsMessageDiv").show();
                $("#searchResultsMessageDiv").text((data != null && data.length > 0) ? data.length + " records found." : "No valid people found.");
                Va.Udo.Crm.Scripts.PeopleList.InitializeStatus = "Initialized";
            }

            function getPeople_complete() {
                $('div#tmpDialog').hide();
            }

            execute();
        };

        $(document).ready(function () {
            if (Va.Udo.Crm.Scripts.PeopleList.InitializeStatus.length == 0) {
                Va.Udo.Crm.Scripts.PeopleList.Initialize();
            }
        });


    </script>
</head>

<body>
    <h1 id="ListTitle" style="padding-top: 12px;">People List</h1>
    <hr>

    <!--<div id="resultsFieldSetDiv" style="width: 100%; display: none;">
        <fieldset id="SearchResultFieldSet">
            <legend>People Results</legend>
            <table id="personSearchResultsTable" style="width: 100%;"></table>
        </fieldset>
    </div>-->

    <div id="createWithoutPerson" style="width: 100%; float: left; display: none;">
        <fieldset id="createWithoutPersonFieldset">
            <button tabindex="16" title="Create Service Person" id="createWithoutPersonButton">Create without Person details</button>
        </fieldset>
    </div>

    <div id="resultsFieldSetDiv" style="width: 100%; float: left; display: none;">
        <div style="clear: both;"></div>
        <div id="searchResultsMessageDiv" style="color: rgb(128, 0, 0); font-size: 1.5em; font-weight: bold; display: none;" aria-label="Search Results Message">
        </div>
        <fieldset id="SearchResultFieldSet">
            <legend style="display: none;">Search Results</legend>
            <table id="personSearchResultsTable" style="width: 100%;"></table>
        </fieldset>
    </div>

    <div id="notFoundDiv" style="width: 100%; float: left; display: none;">
        <fieldset id="notFoundFieldset">
            <legend>No Records Found</legend>
            <hr style="border: 1px solid gray;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <h3 style="padding-bottom: 5px;">People Not Found.</h3>
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
    </div>

    <div id="tmpDialog">
        <img tabindex="0" alt="People List loading. Please wait." src="udo_/images/search/loading.gif">
        <p aria-label="Please Wait">Working on it. Please wait...</p>
    </div>
</body>
</html>